<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CVPD Widget (GitHub Pages)</title>
<link rel="preconnect" href="https://live.zwidgets.com">
<style>
  :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
  body { margin: 24px; }
  .ok { color:#2e7d32; font-weight:600; }
  .warn { color:#ef6c00; font-weight:600; }
  .muted { color:#666; }
  button { padding:10px 14px; border:1px solid #999; border-radius:8px; cursor:pointer; background:#f5f5f5; }
  .card { border:1px solid #ddd; padding:16px; border-radius:12px; max-width:720px; }
</style>

<h2>CVPD Contacts Report — GitHub Pages host</h2>
<div class="card">
  <div id="status" class="muted">Loading Zoho SDK…</div>
  <div style="margin-top:12px;">
    <button id="test">Run SDK test</button>
  </div>
  <p class="muted" style="margin-top:12px;">
    Tip: This page should be opened by a Zoho CRM button set to <b>Open a URL</b> (popup), so the SDK can initialize.
  </p>
</div>

<script src="https://live.zwidgets.com/sdk/v1/js/ZohoEmbededAppSDK.min.js"></script>
<script>
(async () => {
  const el = document.getElementById('status');

  function set(cls, msg) { el.className = cls; el.textContent = msg; }

  if (typeof ZOHO === 'undefined') {
    set('warn', 'Not in Zoho popup (ZOHO is undefined). The page is loaded, but SDK is unavailable.');
    return;
  }
  try {
    set('muted', 'Initializing…');
    await ZOHO.embeddedApp.init();
    set('ok', '✅ SDK OK — running inside Zoho.');
  } catch (e) {
    set('warn', 'SDK init failed: ' + (e && e.message ? e.message : e));
  }

  document.getElementById('test').onclick = async () => {
    try {
      const info = await ZOHO.CRM.API.getOrgInfo();
      alert('Org OK: ' + (info?.org?.[0]?.company_name || 'response received'));
    } catch (e) {
      alert('API failed: ' + (e && e.message ? e.message : e));
    }
  };
})();
</script>
